.\" Automatically generated by Pandoc 1.17.0.3
.\"
.TH "BARMAN" "5" "May 23, 2016" "Barman User manuals" "Version 1.6.1"
.hy
.SH NAME
.PP
barman \- backup and recovery manager for PostgreSQL
.SH CONFIGURATION FILE LOCATIONS
.PP
The system\-level Barman configuration file is located at
.IP
.nf
\f[C]
/etc/barman.conf
\f[]
.fi
.PP
or
.IP
.nf
\f[C]
/etc/barman/barman.conf
\f[]
.fi
.PP
and is overridden on a per\-user level by
.IP
.nf
\f[C]
$HOME/.barman.conf
\f[]
.fi
.SH CONFIGURATION FILE SYNTAX
.PP
The Barman configuration file is a plain \f[C]INI\f[] file.
There is a general section called \f[C][barman]\f[] and a section
\f[C][servername]\f[] for each server you want to backup.
Rows starting with \f[C];\f[] are comments.
.SH CONFIGURATION FILE DIRECTORY
.PP
Barman supports the inclusion of multiple configuration files, through
the \f[C]configuration_files_directory\f[] option.
Included files must contain only server specifications, not global
configurations.
If the value of \f[C]configuration_files_directory\f[] is a directory,
Barman reads all files with \f[C]\&.conf\f[] extension that exist in
that folder.
For example, if you set it to \f[C]/etc/barman.d\f[], you can specify
your PostgreSQL servers placing each section in a separate
\f[C]\&.conf\f[] file inside the \f[C]/etc/barman.d\f[] folder.
.SH OPTIONS
.TP
.B active
When set to \f[C]true\f[] (default), the server is in full operational
state.
When set to \f[C]false\f[], the server can be used for diagnostics, but
any operational command such as backup execution or WAL archiving is
temporarily disabled.
Setting \f[C]active=false\f[] is a good practice when adding a new node
to Barman.
Server.
.RS
.RE
.TP
.B archiver
This option allows you to activate log file shipping through
PostgreSQL\[aq]s \f[C]archive_command\f[] for a server.
If set to \f[C]true\f[] (default), Barman expects that continous
archiving for a server is in place and will activate checks as well as
management (including compression) of WAL files that Postgres deposits
in the \f[I]incoming\f[] directory.
Setting it to \f[C]false\f[], will disable standard continuous archiving
for a server.
Global/Server.
(NOTE: this option is currently required to be enabled until Barman
natively supports physical replication slots.
Setting it to \f[C]false\f[] will result in a disabled server).
.RS
.RE
.TP
.B backup_directory
Directory where backup data for a server will be placed.
Server.
.RS
.RE
.TP
.B backup_method
Configure the way barman executes a backup.
Currently, only \f[C]rsync\f[].
Global/Server.
.RS
.RE
.TP
.B backup_options
This option allows you to control the way Barman interacts with
PostgreSQL for backups.
If set to \f[C]exclusive_backup\f[] (default), \f[C]barman\ backup\f[]
executes backup operations using the standard exclusive backup approach
(technically through pg_start_backup/pg_stop_backup).
If set to \f[C]concurrent_backup\f[], Barman requires the
\f[C]pgespresso\f[] module to be installed on the PostgreSQL server
(this allows you to perform a backup from a standby server).
Global/Server.
.RS
.RE
.TP
.B bandwidth_limit
This option allows you to specify a maximum transfer rate in kilobytes
per second.
A value of zero specifies no limit (default).
Global/Server.
.RS
.RE
.TP
.B barman_home
Main data directory for Barman.
Global.
.RS
.RE
.TP
.B barman_lock_directory
Directory for locks.
Default: \f[C]%(barman_home)s\f[].
Global.
.RS
.RE
.TP
.B basebackups_directory
Directory where base backups will be placed.
Server.
.RS
.RE
.TP
.B basebackup_retry_sleep
Number of seconds of wait after a failed copy, before retrying Used
during both backup and recovery operations.
Positive integer, default 30.
Global/Server.
.RS
.RE
.TP
.B basebackup_retry_times
Number of retries of base backup copy, after an error.
Used during both backup and recovery operations.
Positive integer, default 0.
Global/Server.
.RS
.RE
.TP
.B compression
Standard compression algorithm applied to WAL files.
Possible values are: \f[C]gzip\f[] (requires \f[C]gzip\f[] to be
installed on the system), \f[C]bzip2\f[] (requires \f[C]bzip2\f[]),
\f[C]pigz\f[] (requires \f[C]pigz\f[]), \f[C]pygzip\f[] (Python\[aq]s
internal gzip compressor) and \f[C]pybzip2\f[] (Python\[aq]s internal
bzip2 compressor).
Global/Server.
.RS
.RE
.TP
.B conninfo
Connection string used by Barman to connect to the Postgres server.
Server.
.RS
.RE
.TP
.B custom_compression_filter
Customised compression algorithm applied to WAL files.
Global/Server.
.RS
.RE
.TP
.B custom_decompression_filter
Customised decompression algorithm applied to compressed WAL files; this
must match the compression algorithm.
Global/Server.
.RS
.RE
.TP
.B description
A human readable description of a server.
Server.
.RS
.RE
.TP
.B errors_directory
Directory that contains WAL files that contain an error; usually this is
related to a conflict with an existing WAL file (e.g.
a WAL file that has been archived after a streamed one).
.RS
.RE
.TP
.B immediate_checkpoint
This option allows you to control the way PostgreSQL handles checkpoint
at the start of the backup.
If set to \f[C]false\f[] (default), the I/O workload for the checkpoint
will be limited, according to the \f[C]checkpoint_completion_target\f[]
setting on the PostgreSQL server.
If set to \f[C]true\f[], an immediate checkpoint will be requested,
meaning that PostgreSQL will complete the checkpoint as soon as
possible.
Global/Server.
.RS
.RE
.TP
.B incoming_wals_directory
Directory where incoming WAL files are archived into.
Requires \f[C]archiver\f[] to be enabled.
Server.
.RS
.RE
.TP
.B last_backup_maximum_age
This option identifies a time frame that must contain the latest backup.
If the latest backup is older than the time frame, barman check command
will report an error to the user.
If empty (default), latest backup is always considered valid.
Syntax for this option is: "i (DAYS | WEEKS | MONTHS)" where i is a
integer greater than zero, representing the number of days | weeks |
months of the time frame.
Global/Server.
.RS
.RE
.TP
.B log_file
Location of Barman\[aq]s log file.
Global.
.RS
.RE
.TP
.B log_level
Level of logging (DEBUG, INFO, WARNING, ERROR, CRITICAL).
Global.
.RS
.RE
.TP
.B minimum_redundancy
Minimum number of backups to be retained.
Default 0.
Global/Server.
.RS
.RE
.TP
.B network_compression
This option allows you to enable data compression for network transfers.
If set to \f[C]false\f[] (default), no compression is used.
If set to \f[C]true\f[], compression is enabled, reducing network usage.
Global/Server.
.RS
.RE
.TP
.B path_prefix
One or more absolute paths, separated by colon, where Barman looks for
executable files.
The paths specified in \f[C]path_prefix\f[] are tried before the ones
specified in \f[C]PATH\f[] environment variable.
Global/server.
.RS
.RE
.TP
.B post_archive_retry_script
Hook script launched after a WAL file is archived by maintenance.
Being this a \f[I]retry\f[] hook script, Barman will retry the execution
of the script until this either returns a SUCCESS (0), an ABORT_CONTINUE
(62) or an ABORT_STOP (63) code.
In a post archive scenario, ABORT_STOP has currently the same effects as
ABORT_CONTINUE.
Global/Server.
.RS
.RE
.TP
.B post_archive_script
Hook script launched after a WAL file is archived by maintenance, after
\[aq]post_archive_retry_script\[aq].
Global/Server.
.RS
.RE
.TP
.B post_backup_retry_script
Hook script launched after a base backup.
Being this a \f[I]retry\f[] hook script, Barman will retry the execution
of the script until this either returns a SUCCESS (0), an ABORT_CONTINUE
(62) or an ABORT_STOP (63) code.
In a post backup scenario, ABORT_STOP has currently the same effects as
ABORT_CONTINUE.
Global/Server.
.RS
.RE
.TP
.B post_backup_script
Hook script launched after a base backup, after
\[aq]post_backup_retry_script\[aq].
Global/Server.
.RS
.RE
.TP
.B pre_archive_retry_script
Hook script launched before a WAL file is archived by maintenance, after
\[aq]pre_archive_script\[aq].
Being this a \f[I]retry\f[] hook script, Barman will retry the execution
of the script until this either returns a SUCCESS (0), an ABORT_CONTINUE
(62) or an ABORT_STOP (63) code.
Returning ABORT_STOP will propagate the failure at a higher level and
interrupt the WAL archiving operation.
Global/Server.
.RS
.RE
.TP
.B pre_archive_script
Hook script launched before a WAL file is archived by maintenance.
Global/Server.
.RS
.RE
.TP
.B pre_backup_retry_script
Hook script launched before a base backup, after
\[aq]pre_backup_script\[aq].
Being this a \f[I]retry\f[] hook script, Barman will retry the execution
of the script until this either returns a SUCCESS (0), an ABORT_CONTINUE
(62) or an ABORT_STOP (63) code.
Returning ABORT_STOP will propagate the failure at a higher level and
interrupt the backup operation.
Global/Server.
.RS
.RE
.TP
.B pre_backup_script
Hook script launched before a base backup.
Global/Server.
.RS
.RE
.TP
.B recovery_options
Options for recovery operations.
Currently only supports \f[C]get\-wal\f[].
\f[C]get\-wal\f[] activates generation of a basic
\f[C]restore_command\f[] in the resulting \f[C]recovery.conf\f[] file
that uses the \f[C]barman\ get\-wal\f[] command to fetch WAL files
directly from Barman\[aq]s archive of WALs.
Comma separated list of values, default empty.
Global/Server.
.RS
.RE
.TP
.B retention_policy
Policy for retention of periodic backups and archive logs.
If left empty, retention policies are not enforced.
For redundancy based retention policy use "REDUNDANCY i" (where i is an
integer > 0 and defines the number of backups to retain).
For recovery window retention policy use "RECOVERY WINDOW OF i DAYS" or
"RECOVERY WINDOW OF i WEEKS" or "RECOVERY WINDOW OF i MONTHS" where i is
a positive integer representing, specifically, the number of days, weeks
or months to retain your backups.
For more detailed information, refer to the official documentation.
Default value is empty.
Global/Server.
.RS
.RE
.TP
.B retention_policy_mode
Currently only "auto" is implemented.
Global/Server.
.RS
.RE
.TP
.B reuse_backup
This option controls incremental backup support.
Global/Server.
Possible values are: * \f[C]off\f[]: disabled (default); *
\f[C]copy\f[]: reuse the last available backup for a server and create a
copy of the unchanged files (reduce backup time); * \f[C]link\f[]: reuse
the last available backup for a server and create a hard link of the
unchanged files (reduce backup time and space).
Requires operating system and file system support for hard links.
.RS
.RE
.TP
.B streaming_archiver
This option allows you to use the PostgreSQL\[aq]s streaming protocol to
receive transaction logs from a server.
If set to \f[C]on\f[], Barman expects to find \f[C]pg_receivexlog\f[] in
the PATH (see \f[C]path\f[] option) and that streaming connection for
the server is working.
This activates connection checks as well as management (including
compression) of WAL files.
If set to \f[C]off\f[] (default) barman will rely only on continuous
archiving for a server WAL archive operations, eventually terminating
any running \f[C]pg_receivexlog\f[] for the server.
Global/Server.
.RS
.RE
.TP
.B streaming_archiver_name
Identifier to be used as \f[C]application_name\f[] by the
\f[C]receive\-wal\f[] command.
Only available with \f[C]pg_receivexlog\f[] >= 9.3.
By default it is set to \f[C]barman_receive_wal\f[].
Global/Server.
.RS
.RE
.TP
.B streaming_conninfo
Connection string used by Barman to connect to the Postgres server via
streaming replication protocol.
By default it is set to \f[C]conninfo\f[].
Server.
.RS
.RE
.TP
.B streaming_wals_directory
Directory where WAL files are streamed from the PostgreSQL server to
Barman.
Requires \f[C]streaming_archiver\f[] to be enabled.
Server.
.RS
.RE
.TP
.B ssh_command
Command used by Barman to login to the Postgres server via ssh.
Server.
.RS
.RE
.TP
.B tablespace_bandwidth_limit
This option allows you to specify a maximum transfer rate in kilobytes
per second, by specifying a comma separated list of tablespaces (pairs
TBNAME:BWLIMIT).
A value of zero specifies no limit (default).
Global/Server.
.RS
.RE
.TP
.B wal_retention_policy
Policy for retention of archive logs (WAL files).
Currently only "MAIN" is available.
Global/Server.
.RS
.RE
.TP
.B wals_directory
Directory which contains WAL files.
Server.
.RS
.RE
.SH HOOK SCRIPTS
.PP
The script definition is passed to a shell and can return any exit code.
.PP
The shell environment will contain the following variables:
.TP
.B \f[C]BARMAN_CONFIGURATION\f[]
configuration file used by barman
.RS
.RE
.TP
.B \f[C]BARMAN_ERROR\f[]
error message, if any (only for the \[aq]post\[aq] phase)
.RS
.RE
.TP
.B \f[C]BARMAN_PHASE\f[]
\[aq]pre\[aq] or \[aq]post\[aq]
.RS
.RE
.TP
.B \f[C]BARMAN_RETRY\f[]
\f[C]1\f[] if it is a \f[I]retry script\f[] (from 1.5.0), \f[C]0\f[] if
not
.RS
.RE
.TP
.B \f[C]BARMAN_SERVER\f[]
name of the server
.RS
.RE
.PP
Backup scripts specific variables:
.TP
.B \f[C]BARMAN_BACKUP_DIR\f[]
backup destination directory
.RS
.RE
.TP
.B \f[C]BARMAN_BACKUP_ID\f[]
ID of the backup
.RS
.RE
.TP
.B \f[C]BARMAN_PREVIOUS_ID\f[]
ID of the previous backup (if present)
.RS
.RE
.TP
.B \f[C]BARMAN_STATUS\f[]
status of the backup
.RS
.RE
.TP
.B \f[C]BARMAN_VERSION\f[]
version of Barman
.RS
.RE
.PP
Archive scripts specific variables:
.TP
.B \f[C]BARMAN_SEGMENT\f[]
name of the WAL file
.RS
.RE
.TP
.B \f[C]BARMAN_FILE\f[]
full path of the WAL file
.RS
.RE
.TP
.B \f[C]BARMAN_SIZE\f[]
size of the WAL file
.RS
.RE
.TP
.B \f[C]BARMAN_TIMESTAMP\f[]
WAL file timestamp
.RS
.RE
.TP
.B \f[C]BARMAN_COMPRESSION\f[]
type of compression used for the WAL file
.RS
.RE
.PP
Only in case of retry hook scripts, the exit code of the script is
checked by Barman.
Output of hook scripts is simply written in the log file.
.SH EXAMPLE
.PP
Here is an example of configuration file:
.IP
.nf
\f[C]
[barman]
;\ Main\ directory
barman_home\ =\ /var/lib/barman

;\ System\ user
barman_user\ =\ barman

;\ Log\ location
log_file\ =\ /var/log/barman/barman.log

;\ Default\ compression\ level
;compression\ =\ gzip

;\ Incremental\ backup
reuse_backup\ =\ link

;\ \[aq]main\[aq]\ PostgreSQL\ Server\ configuration
[main]
;\ Human\ readable\ description
description\ =\ \ "Main\ PostgreSQL\ Database"

;\ SSH\ options
ssh_command\ =\ ssh\ postgres\@pg

;\ PostgreSQL\ connection\ string
conninfo\ =\ host=pg\ user=postgres

;\ PostgreSQL\ streaming\ connection\ string
streaming_conninfo\ =\ host=pg\ user=postgres

;\ Minimum\ number\ of\ required\ backups\ (redundancy)
minimum_redundancy\ =\ 1

;\ Retention\ policy\ (based\ on\ redundancy)
retention_policy\ =\ REDUNDANCY\ 2
\f[]
.fi
.SH SEE ALSO
.PP
\f[C]barman\f[] (1).
.SH AUTHORS
.PP
In alphabetical order:
.IP \[bu] 2
Gabriele Bartolini <gabriele.bartolini@2ndquadrant.it> (project leader)
.IP \[bu] 2
Stefano Bianucci <stefano.bianucci@2ndquadrant.it> (developer)
.IP \[bu] 2
Giuseppe Broccolo <giuseppe.broccolo@2ndquadrant.it> (QA/testing)
.IP \[bu] 2
Giulio Calacoci <giulio.calacoci@2ndquadrant.it> (developer)
.IP \[bu] 2
Francesco Canovai <francesco.canovai@2ndquadrant.it> (QA/testing)
.IP \[bu] 2
Leonardo Cecchi <leonardo.cecchi@2ndquadrant.it> (developer)
.IP \[bu] 2
Gianni Ciolli <gianni.ciolli@2ndquadrant.it> (QA/testing)
.IP \[bu] 2
Marco Nenciarini <marco.nenciarini@2ndquadrant.it> (lead developer)
.PP
Past contributors:
.IP \[bu] 2
Carlo Ascani
.SH RESOURCES
.IP \[bu] 2
Homepage: <http://www.pgbarman.org/>
.IP \[bu] 2
Documentation: <http://docs.pgbarman.org/>
.SH COPYING
.PP
Barman is the exclusive property of 2ndQuadrant Italia and its code is
distributed under GNU General Public License v3.
.PP
Copyright (C) 2011\-2016 2ndQuadrant Italia Srl \-
http://www.2ndQuadrant.it/.
.SH AUTHORS
2ndQuadrant Italy <http://www.2ndQuadrant.it>.
