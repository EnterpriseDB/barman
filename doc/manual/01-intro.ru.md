\newpage

# Введение 

В идеальном мире не было бы необходимости в резервном копировании.
Однако важно, особенно в бизнес-средах, быть готовым к тому,
что _"неожиданности"_ случаются. При работе СУБД к неожиданностям 
относят следующие формы:

- повреждение данных
- сбой системы (включая аппаратные ошибки)
- челевеческий фактор
- природные факторы

В таких случаях любой ИТ менеджер или администратор базы данных
должны иметь возможность исправить инцидент и восстановить базу
данных в кратчайшие сроки. Обычно это называется
**аварийным восстановлением**, а в более широком смысле
*непрерывностью бизнеса*.

В рамках понятия непрерывности бизнеса важно ознакомиться с двумя фундаментальными показателями (определение из Википедии):

- [**Recovery Point Objective (RPO)**] [rpo]: _"maximum targeted period in which data might be lost from an IT service due to a major incident"_
- [**Recovery Time Objective (RTO)**] [rto]: _"the targeted duration of time and a service level within which a business process must be restored after a disaster (or disruption) in order to avoid unacceptable consequences associated with a break in business continuity"_

http://www.securitylab.ru/blog/personal/shaurojen/22770.php

Допустимая точка восстановления (RPO) определяется допускаемым уровнем потери данных в случае прерывания операций. Она показывает точку во времени, с которой можно восстановить данные. Например, если процесс может предоставить данные за последние 4 часа до происшествия, то последняя резервная копия должна быть сделана не позднее 4-х часов назад. Вначале восстанавливаются данные из резервной копии, затем добавляются данные за последние 4 часа. Таким образом, RPO определяет количество данных, которые могут быть потеряны, т.к. их всегда можно восстановить.

Допустимое время восстановления (RTO) определяется количеством времени неработоспособности сервиса в случае прерывания операций. Оно показывает раннюю точку времени, после которой операции могут быть продолжены. Обе концепции основываются на временных параметрах.

В нескольких словах, RPO представляет максимальное количество данных, которые вы можете себе позволить потерять, в то время как RTO представляет максимальное время простоя, которое вы можете себе позволить для своей службы.

Понятно, что всем хочется иметь **RPO = 0** (*«нулевая потеря данных»*) и **RTO = 0** (*нулевое время простоя*) - даже если это веб-сайт рецептов наших бабушек.
На практике, тщательный анализ затрат, позволяет определить требования к непрерывности бизнеса.

К счастью, в проектах с открытым исходным кодом, состоящим из **Barman** и **PostgreSQL**, вы можете достичь RPO = 0 благодаря синхронной репликации потоков. RTO больше фокусируется на *High Availability* решениях, например [**repmgr**] [repmgr]. Поэтому, интегрируя Barman и repmgr, вы можете значительно снизить RTO до нуля.

Основываясь на нашем опыте в 2ndQuadrant, мы можем подтвердить, что кластеры с открытым исходным кодом PostgreSQL с Barman и repmgr могут легко достичь более 99,99% времени бесперебойной работы в течение года, если их правильно настроить и контролировать.

В любом случае нам важно уделять больше внимания культурным аспектам, связанным с аварийным восстановлением, а не фактическим инструментам. Инструменты без людей бесполезны.

Наша миссия с Barman - продвигать культуру восстановления после сбоев, которая:

- фокусируется на процедурах резервного копирования
- больше внимания уделяется процедурам восстановления
- полагается на образование и обучение сильным теоретическим и практическим концепциям восстановления после сбоев PostgreSQL, резервного копирования, Point-In-Time-Recovery и репликации для членов вашей команды
- способствует тестированию ваших резервных копий (только проверенная копия может считаться действительной), либо вручную, либо автоматически (креатив с использованием скриптов Barman)!
- способствует регулярной практике процедур восстановления всеми членами вашей команды разработчиков (да, разработчики тоже, а не только системных администраторов и администраторов баз данных)
- приглашает к регулярным тренировкам и симуляторам аварийного восстановления с командой каждые 3-6 месяцев
- полагается на непрерывный мониторинг PostgreSQL и Barman, и это позволяет оперативно выявлять любые аномалии

Кроме того, сделайте все возможное, чтобы подготовить себя и свою команду к тому моменту, когда произойдет катастрофа (да, *когда*), потому что это когда произойдет:

- Это будет вечер пятницы, скорее всего, когда вы собираетесь покинуть офис.
- Это будет, когда вы в отпуске (прямо посреди круиза по всему миру), и кто-то другой должен с этим справиться.
- Это определенно будет напряженным.
- Вы пожалеете, что не уверены, что последняя доступная резервная копия действительна.
- Если вы не знаете, сколько времени потребуется для восстановления, каждая секунда будет казаться вечной.

Будьте готовы, не бойтесь.

В 2011 году, имея в виду эти цели, 2Quadrant начал разработку Barman, теперь один из наиболее используемых инструментов резервного копирования для PostgreSQL. Barman - это сокращение от «Backup and Recovery Manager».

В настоящее время Barman работает только на операционных системах Linux и Unix.