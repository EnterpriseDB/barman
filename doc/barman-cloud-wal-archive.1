.\" Automatically generated by Pandoc 2.2.1
.\"
.TH "BARMAN\-CLOUD\-WAL\-ARCHIVE" "1" "October 20, 2022" "Barman User manuals" "Version 3.2.0"
.hy
.SH NAME
.PP
barman\-cloud\-wal\-archive \- Archive PostgreSQL WAL files in the Cloud
using \f[C]archive_command\f[]
.SH SYNOPSIS
.PP
barman\-cloud\-wal\-archive [\f[I]OPTIONS\f[]] \f[I]DESTINATION_URL\f[]
\f[I]SERVER_NAME\f[] \f[I]WAL_PATH\f[]
.SH DESCRIPTION
.PP
This script can be used in the \f[C]archive_command\f[] of a PostgreSQL
server to ship WAL files to the Cloud.
Currently AWS S3, Azure Blob Storage and Google Cloud Storage are
supported.
.PP
Note: If you are running python 2 or older unsupported versions of
python 3 then avoid the compression options \f[C]\-\-gzip\f[] or
\f[C]\-\-bzip2\f[] as barman\-cloud\-wal\-restore is unable to restore
gzip\-compressed WALs on python < 3.2 or bzip2\-compressed WALs on
python < 3.3.
.PP
This script and Barman are administration tools for disaster recovery of
PostgreSQL servers written in Python and maintained by EnterpriseDB.
.SH POSITIONAL ARGUMENTS
.TP
.B DESTINATION_URL
URL of the cloud destination, such as a bucket in AWS S3.
For example: \f[C]s3://BUCKET_NAME/path/to/folder\f[] (where
\f[C]BUCKET_NAME\f[] is the bucket you have created in AWS).
.RS
.RE
.TP
.B SERVER_NAME
the name of the server as configured in Barman.
.RS
.RE
.TP
.B WAL_PATH
the value of the `%p' keyword (according to `archive_command').
.RS
.RE
.SH OPTIONS
.TP
.B \-h, \[en]help
show a help message and exit
.RS
.RE
.TP
.B \-V, \[en]version
show program's version number and exit
.RS
.RE
.TP
.B \-v, \[en]verbose
increase output verbosity (e.g., \-vv is more than \-v)
.RS
.RE
.TP
.B \-q, \[en]quiet
decrease output verbosity (e.g., \-qq is less than \-q)
.RS
.RE
.TP
.B \-t, \[en]test
test connectivity to the cloud destination and exit
.RS
.RE
.TP
.B \-z, \[en]gzip
gzip\-compress the WAL while uploading to the cloud (should not be used
with python < 3.2)
.RS
.RE
.TP
.B \-j, \[en]bzip2
bzip2\-compress the WAL while uploading to the cloud (should not be used
with python < 3.3)
.RS
.RE
.TP
.B \[en]snappy
snappy\-compress the WAL while uploading to the cloud (requires optional
python\-snappy library and should not be used with python < 3.3)
.RS
.RE
.TP
.B \[en]cloud\-provider {aws\-s3,azure\-blob\-storage,google\-cloud\-storage}
the cloud provider to which the backup should be uploaded
.RS
.RE
.TP
.B \[en]tags KEY1,VALUE1 KEY2,VALUE2 \&...
A space\-separated list of comma\-separated key\-value pairs
representing tags to be added to each WAL file archived to cloud
storage.
.RS
.RE
.TP
.B \[en]history\-tags KEY1,VALUE1 KEY2,VALUE2 \&...
A space\-separated list of comma\-separated key\-value pairs
representing tags to be added to each history file archived to cloud
storage.
If this is provided alongside the \f[C]\-\-tags\f[] option then the
value of \f[C]\-\-history\-tags\f[] will be used in place of
\f[C]\-\-tags\f[] for history files.
All other WAL files will continue to be tagged with the value of
\f[C]\-\-tags\f[].
.RS
.RE
.TP
.B \-P, \[en]profile
profile name (e.g.\ INI section in AWS credentials file)
.RS
.RE
.TP
.B \[en]endpoint\-url
override the default S3 URL construction mechanism by specifying an
endpoint.
.RS
.RE
.TP
.B \-e, \[en]encryption
the encryption algorithm used when storing the uploaded data in S3
Allowed values: `AES256'|`aws:kms'
.RS
.RE
.TP
.B \[en]encryption\-scope
the name of an encryption scope defined in the Azure Blob Storage
service which is to be used to encrypt the data in Azure
.RS
.RE
.TP
.B \[en]read\-timeout \f[I]TIMEOUT\f[]
the time in seconds until a timeout is raised when waiting to read from
a connection to AWS S3 (defaults to 60 seconds)
.RS
.RE
.TP
.B \[en]credential {azure\-cli,managed\-identity}
optionally specify the type of credential to use when authenticating
with Azure Blob Storage.
If omitted then the credential will be obtained from the environment.
If no credentials can be found in the environment then the default Azure
authentication flow will be used.
.RS
.RE
.TP
.B \[en]max\-block\-size SIZE
the chunk size to be used when uploading an object to Azure Blob Storage
via the concurrent chunk method (default: 4MB).
.RS
.RE
.TP
.B \[en]max\-concurrency CONCURRENCY
the maximum number of chunks to be uploaded concurrently to Azure Blob
Storage (default: 1).
Whether the maximum concurrency is achieved depends on the values of
\[en]max\-block\-size (should be less than or equal to
\f[C]WAL\ segment\ size\ after\ compression\ /\ max_concurrency\f[]) and
\[en]max\-single\-put\-size (must be less than WAL segment size after
compression).
.RS
.RE
.TP
.B \[en]max\-single\-put\-size SIZE
maximum size for which the Azure client will upload an object to Azure
Blob Storage in a single request (default: 64MB).
If this is set lower than the WAL segment size after any applied
compression then the concurrent chunk upload method for WAL archiving
will be used.
.RS
.RE
.SH REFERENCES
.PP
For Boto:
.IP \[bu] 2
https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html
.PP
For AWS:
.IP \[bu] 2
https://docs.aws.amazon.com/cli/latest/userguide/cli\-chap\-getting\-set\-up.html
.IP \[bu] 2
https://docs.aws.amazon.com/cli/latest/userguide/cli\-chap\-getting\-started.html.
.PP
For Azure Blob Storage:
.IP \[bu] 2
https://docs.microsoft.com/en\-us/azure/storage/blobs/authorize\-data\-operations\-cli#set\-environment\-variables\-for\-authorization\-parameters
.IP \[bu] 2
https://docs.microsoft.com/en\-us/python/api/azure\-storage\-blob/?view=azure\-python
.PP
For Google Cloud Storage: * Credentials:
https://cloud.google.com/docs/authentication/getting\-started#setting_the_environment_variable
.PP
Only authentication with \f[C]GOOGLE_APPLICATION_CREDENTIALS\f[] env is
supported at the moment.
.SH DEPENDENCIES
.PP
If using \f[C]\-\-cloud\-provider=aws\-s3\f[]:
.IP \[bu] 2
boto3
.PP
If using \f[C]\-\-cloud\-provider=azure\-blob\-storage\f[]:
.IP \[bu] 2
azure\-storage\-blob
.IP \[bu] 2
azure\-identity (optional, if you wish to use DefaultAzureCredential)
.PP
If using \f[C]\-\-cloud\-provider=google\-cloud\-storage\f[] *
google\-cloud\-storage
.SH EXIT STATUS
.TP
.B 0
Success
.RS
.RE
.TP
.B 1
The WAL archive operation was not successful
.RS
.RE
.TP
.B 2
The connection to the cloud provider failed
.RS
.RE
.TP
.B 3
There was an error in the command input
.RS
.RE
.TP
.B Other non\-zero codes
Failure
.RS
.RE
.SH SEE ALSO
.PP
This script can be used in conjunction with
\f[C]pre_archive_retry_script\f[] to relay WAL files to S3, as follows:
.IP
.nf
\f[C]
pre_archive_retry_script\ =\ \[aq]barman\-cloud\-wal\-archive\ [*OPTIONS*]\ *DESTINATION_URL*\ ${BARMAN_SERVER}\[aq]
\f[]
.fi
.SH BUGS
.PP
Barman has been extensively tested, and is currently being used in
several production environments.
However, we cannot exclude the presence of bugs.
.PP
Any bug can be reported via the GitHub issue tracker.
.SH RESOURCES
.IP \[bu] 2
Homepage: <https://www.pgbarman.org/>
.IP \[bu] 2
Documentation: <https://docs.pgbarman.org/>
.IP \[bu] 2
Professional support: <https://www.enterprisedb.com/>
.SH COPYING
.PP
Barman is the property of EnterpriseDB UK Limited and its code is
distributed under GNU General Public License v3.
.PP
Â© Copyright EnterpriseDB UK Limited 2011\-2022
.SH AUTHORS
EnterpriseDB <https://www.enterprisedb.com>.
